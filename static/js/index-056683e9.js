import{v as q,w as h}from"./@vue.runtime-dom-99571815.js";import{m as K,l as W,n as E,u as F,i as J}from"./index-bb32f0e8.js";import{X,Y,u as G,P as H}from"./@element-plus.icons-vue-73c86597.js";import{a as Q}from"./@vueuse.core-c33523a6.js";import{B as R,D as Z}from"./lodash-es-74a5df03.js";import"./store-acb3382e.js";import{u as M}from"./index-0aca6396.js";import{W as j}from"./ts-wps-c1dd0e62.js";import{a as D}from"./element-plus-ca11a4ea.js";import{j as k,X as b,o as n,J as g,K as x,a as m,c as w,N as I,b as y,t as O,q as ee,d as te,F as B,L as oe,a1 as se}from"./@vue.runtime-core-561bebe5.js";import{r as V,j as N,u as p,t as ie}from"./@vue.reactivity-97074417.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import{O as P,o as z,p as ne}from"./@vue.shared-40d3234d.js";const{options:ae}=K.get("upload"),$=ae.rules||[];function le(e){return W(e.substring(e.indexOf("_")+1))}function re(e){return $.find(t=>t.exts.find(u=>u==E(e||"").toLocaleLowerCase()))||R($)}function ce(e){return $.find(a=>a.type==e)||R($)}function ue(e){return re(e).type}function qe(e){return e.map(a=>a.url.replace(/,/g,encodeURIComponent(",")))}function Ke(...e){if(e.length===0)return"";const a=e[0];let t=!1;a.startsWith("http")&&(t=!0);const u=e.map(l=>l.replace(/(^\/+|\/+$)/g,""));return u.join("/")}const de=m("div",{class:"file-wps"},null,-1),me=k({name:"undefined"}),pe=k({...me,setup(e,{expose:a}){const{service:t}=M(),{user:u}=F(),l=V(""),d=V(!1);async function f(){l.value||await t.space.info.getConfig().then(r=>{l.value=r.appId})}let _=null;async function o(r){if(d.value=!0,await f(),!l.value)return D.error("请先配置WPS的应用ID");_=j.init({officeType:j.OfficeType[r.officeType],appId:l.value,fileId:r.fileId,mount:document.querySelector(".file-wps"),fileToken:{token:u.token,timeout:10*60*1e3}}),_.ready()}function v(){_.destroy()}return a({open:o}),(r,c)=>{const s=b("cl-dialog");return n(),g(s,{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=i=>d.value=i),width:"80%",onClosed:v},{default:x(()=>[de]),_:1},8,["modelValue"])}}});const fe={class:"file-viewer"},_e=k({name:"file-viewer"}),ve=k({..._e,setup(e,{expose:a}){let t;(o=>{o.word="Writer",o.excel="Spreadsheet",o.ppt="Presentation",o.pdf="Pdf"})(t||(t={}));const{refs:u,setRefs:l}=M(),d=N({visible:!1,url:""});function f(o){var v;if(o!=null&&o.type){const r=o.url||"",c=ue(r);if(c=="image")return d.visible=!0,d.url=r,!0;if(Z(t,c))return(v=u.wps)==null?void 0:v.open(Object.assign(ie(o),{officeType:t[o.type]}));window.open(o.url)}}function _(){d.visible=!1}return a({open:f}),(o,v)=>{const r=b("el-image-viewer");return n(),w("div",fe,[d.visible?(n(),g(r,{key:0,"url-list":[d.url],infinite:"",teleported:"",onClose:_},null,8,["url-list"])):I("",!0),y(pe,{ref:p(l)("wps")},null,512)])}}});const ye=T(ve,[["__scopeId","data-v-b5137cd3"]]),ge={class:"cl-upload-item__wrap"},we=["onContextmenu"],be=["src"],ke={class:"cl-upload-item__icon"},he={class:"cl-upload-item__name"},xe=["src"],Ce={class:"cl-upload-item__progress-bar"},Pe={class:"cl-upload-item__progress-value"},Ie={key:4,class:"cl-upload-item__actions"},$e=k({name:"cl-upload-item"}),Me=k({...$e,props:{item:{type:Object,required:!0},list:{type:Array,default:()=>[]},disabled:Boolean},emits:["remove"],setup(e,{emit:a}){const t=e,{refs:u,setRefs:l}=M(),{copy:d}=Q(),f=O(()=>t.item.url||""),_=O(()=>({color:ce(t.item.type).color,name:E(t.item.name||f.value)}));function o(){a("remove",t.item)}function v(){u.viewer.open(t.item)}function r(s){J.ContextMenu.open(s,{hover:{target:"cl-upload-item__wrap"},list:[{label:"預覽",callback(i){v(),i()}},{label:"複製鏈接",callback(i){t.item.url&&(d(t.item.url),D.success("複製成功")),i()}},{label:"刪除",callback(i){o(),i()}}]})}const c=N({isMedia:["video","audio"].includes(t.item.type),play(){t.list.forEach(s=>{s.isPlay=s.uid?t.item.uid==s.uid:t.item.id==s.id})},pause(){t.item.isPlay=!1},create(){if(!c.isMedia)return!1;const s=u[t.item.type];ee(()=>t.item.isPlay,i=>{i?s.play():s.pause()}),s==null||s.addEventListener("ended",()=>{c.pause()})}});return te(()=>{c.create()}),(s,i)=>{const U=b("el-image"),A=b("cl-svg"),L=b("el-progress"),C=b("el-icon");return n(),w("div",ge,[(n(),g(se,null,[m("div",{class:z(["cl-upload-item",[{"is-play":e.item.isPlay}]]),onContextmenu:h(r,["stop","prevent"])},[e.item.type==="image"&&!e.item.error?(n(),g(U,{key:0,class:"cl-upload-item__image-cover",fit:"contain",src:e.item.preload||f.value,lazy:"",onError:i[0]||(i[0]=S=>e.item.error="加載失敗")},null,8,["src"])):e.item.type==="video"&&e.item.url?(n(),w("video",{key:1,ref:p(l)("video"),src:e.item.url},null,8,be)):(n(),w(B,{key:2},[m("div",ke,[y(A,{name:e.item.type},null,8,["name"])]),m("div",he,[m("span",null,P(p(le)(e.item.name||f.value)),1),oe(m("span",{class:"error"},P(e.item.error),513),[[q,e.item.error]])])],64)),e.item.type==="audio"?(n(),w("audio",{key:3,controls:"",ref:p(l)("audio")},[m("source",{src:e.item.url,type:"audio/mpeg"},null,8,xe)],512)):I("",!0),m("div",{class:z(["cl-upload-item__progress",{"is-show":e.item.progress>=0&&e.item.progress<100,"is-hide":e.item.progress==100}])},[m("div",Ce,[y(L,{percentage:e.item.progress,"show-text":!1},null,8,["percentage"])]),m("span",Pe,P(e.item.progress),1)],2),m("span",{class:"cl-upload-item__tag",style:ne({backgroundColor:_.value.color})},P(_.value.name),5),f.value?(n(),w("div",Ie,[c.isMedia?(n(),w(B,{key:0},[e.item.isPlay?(n(),g(C,{key:0,onClick:i[1]||(i[1]=h(S=>c.pause(),["stop"]))},{default:x(()=>[y(p(X))]),_:1})):(n(),g(C,{key:1,onClick:i[2]||(i[2]=h(S=>c.play(),["stop"]))},{default:x(()=>[y(p(Y))]),_:1}))],64)):(n(),g(C,{key:1,onClick:h(v,["stop"])},{default:x(()=>[y(p(G))]),_:1},8,["onClick"])),e.disabled?I("",!0):(n(),g(C,{key:2,onClick:h(o,["stop"])},{default:x(()=>[y(p(H))]),_:1},8,["onClick"]))])):I("",!0)],42,we)],1024)),y(ye,{ref:p(l)("viewer")},null,512)])}}});const Se=T(Me,[["__scopeId","data-v-57630efe"]]),We=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));export{Se as U,ue as a,qe as g,We as i,Ke as p};
