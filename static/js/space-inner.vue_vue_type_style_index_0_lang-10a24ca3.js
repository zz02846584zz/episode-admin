import{v as $}from"./@vue.runtime-dom-99571815.js";import{_ as A}from"./@element-plus.icons-vue-73c86597.js";import{U as H}from"./index-4209ee1e.js";import"./index-7178fe38.js";import{u as Q}from"./hook-e44cd511.js";import"./store-acb3382e.js";import{u as W}from"./index-819678c4.js";import{a as y,b as Y}from"./element-plus-ca11a4ea.js";import{j as S,q as Z,E as ee,X as d,$ as ae,o as p,c as _,b as s,K as u,a as i,O as E,J as z,N as te,L as I,F as le,V as ne}from"./@vue.runtime-core-561bebe5.js";import{r as V,j as oe,u as m}from"./@vue.reactivity-97074417.js";import{o as se,O as M}from"./@vue.shared-40d3234d.js";const ie={class:"cl-upload-space-inner__right"},ce={class:"cl-upload-space-inner__header"},re={style:{margin:"0px 10px"}},pe=["onClick"],ue={class:"cl-upload-space-inner__file-index"},de={key:1,class:"cl-upload-space-inner__file-empty"},fe=i("p",null,"將文件拖到此處，或點擊按鈕上傳",-1),_e={class:"cl-upload-space-inner__footer"},me=S({name:"cl-upload-space-inner"}),De=S({...me,props:{limit:{type:Number,default:99},accept:String,selectable:Boolean},emits:["selection-change","confirm"],setup(b,{expose:j,emit:O}){const v=b,{service:g,browser:x,refs:U,setRefs:q}=W(),{ViewGroup:D}=Q({label:"分類",title:"文件列表",service:g.space.type,onEdit(){return{width:"400px",props:{labelPosition:"top"},dialog:{controls:["close"]},items:[{label:"名稱",prop:"name",value:"",required:!0,component:{name:"el-input",props:{maxlength:20,clearable:!0}}}]}},onSelect(e){f({classifyId:e.id,page:1})}}),h=V(!1),l=V([]),c=V([]),r=oe({page:1,size:20,total:0});function G(){l.value=[]}function P(e){var a,t;g.space.info.add({classifyId:(t=(a=D.value)==null?void 0:a.selected)==null?void 0:t.id,...e}).then(o=>{e.id=o.id}).catch(o=>{y.error(o.message)})}function T(e){c.value.unshift(e)}const w={page:1};async function f(e){var a;Object.assign(w,{type:((a=v.accept)==null?void 0:a.split("/")[0].replace("*",""))||void 0,...r,...e}),w.page==1&&(h.value=!0),await g.space.info.page(w).then(t=>{Object.assign(r,t.pagination),c.value=t.list}),h.value=!1}function F(e){const a=l.value.findIndex(t=>t.id===e.id);a>=0?l.value.splice(a,1):v.limit==1?l.value=[e]:l.value.length<v.limit?l.value.push(e):y.warning(`最多隻能選擇${v.limit}個文件`)}function B(e){return l.value.findIndex(a=>a.id===e)+1}function N(e){const a=e?[e.id]:l.value.map(t=>t.id);Y.confirm("此操作將刪除文件, 是否繼續?","提示",{type:"warning"}).then(()=>{y.success("刪除成功"),a.forEach(t=>{[c.value,l.value].forEach(o=>{const k=o.findIndex(C=>C.id===t);o.splice(k,1)})}),g.space.info.delete({ids:a}).catch(t=>{y.error(t.message)})}).catch(()=>null)}function L(e){e.preventDefault()}function R(e){e.preventDefault(),e.dataTransfer.files.forEach((a,t)=>{setTimeout(()=>{U.upload.upload(a)},t*10)})}return Z(l,e=>{O("selection-change",e)},{deep:!0}),ee("upload-space",{selection:l,refresh:f,loading:h,list:c}),j({selection:l,open,close,clear:G,refresh:f}),(e,a)=>{const t=d("el-button"),o=d("cl-upload"),k=d("el-icon"),C=d("el-scrollbar"),J=d("el-pagination"),K=d("cl-view-group"),X=ae("loading");return p(),_("div",{class:"cl-upload-space-inner",onDragover:L,onDrop:R},[s(K,{ref_key:"ViewGroup",ref:D},{right:u(()=>[i("div",ie,[i("div",ce,[s(t,{onClick:a[0]||(a[0]=n=>f({page:1}))},{default:u(()=>[E("刷新")]),_:1}),i("div",re,[s(o,{ref:m(q)("upload"),menu:"space",type:"file",multiple:"","show-file-list":!1,limit:9999,accept:b.accept,onSuccess:P,onUpload:T},{default:u(()=>[s(t,{type:"primary"},{default:u(()=>[E("點擊上傳")]),_:1})]),_:1},8,["accept"])]),b.selectable?te("",!0):(p(),z(t,{key:0,type:"danger",disabled:l.value.length==0,onClick:a[1]||(a[1]=n=>N())},{default:u(()=>[E("刪除選中文件")]),_:1},8,["disabled"]))]),I((p(),z(C,{class:"cl-upload-space-inner__file"},{default:u(()=>[c.value.length>0?(p(),_("div",{key:0,class:se(["cl-upload-space-inner__file-list",{"is-mini":m(x).isMini}])},[(p(!0),_(le,null,ne(c.value,n=>(p(),_("div",{class:"cl-upload-space-inner__file-item",key:n.preload||n.url,onClick:ve=>F(n)},[s(H,{item:n,list:c.value,onRemove:N},null,8,["item","list"]),I(i("div",ue,[i("span",null,M(B(n.id)),1)],512),[[$,B(n.id)]])],8,pe))),128))],2)):(p(),_("div",de,[s(k,{class:"el-icon--upload"},{default:u(()=>[s(m(A))]),_:1}),fe]))]),_:1})),[[X,h.value]]),i("div",_e,[s(J,{small:!!m(x).isMini,total:r.total,"default-page-size":r.size,"current-page":r.page,"onUpdate:currentPage":a[2]||(a[2]=n=>r.page=n),background:"",layout:"prev, pager, next",onCurrentChange:a[3]||(a[3]=n=>f())},null,8,["small","total","default-page-size","current-page"]),I(i("span",{class:"total"},"共 "+M(r.total)+" 條",513),[[$,!m(x).isMini]])])])]),_:1},512)],32)}}});export{De as _};
