import{w as S}from"./@vue.runtime-dom-99571815.js";import{i as M,a as A}from"./index-7178fe38.js";import"./store-acb3382e.js";import{u as L}from"./index-819678c4.js";import{B as J,X as K,Y as P,Z as R,P as U}from"./@element-plus.icons-vue-73c86597.js";import{j as I,X as l,o as c,J as T,K as i,b as n,n as Z,am as G,$ as Q,c as v,a as p,F as W,V as ee,L as $,as as te,ar as oe,O as z}from"./@vue.runtime-core-561bebe5.js";import{r as O,j as se,u as r}from"./@vue.reactivity-97074417.js";import{a as b,b as H}from"./element-plus-ca11a4ea.js";import{o as ne,O as N}from"./@vue.shared-40d3234d.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-f6771985.js";import"./nprogress-5ff42f71.js";import"./chardet-cfd7d38a.js";import"./pinia-d82d1bdc.js";import"./vue-demi-71ba0ef2.js";import"./monaco-editor-f913c445.js";import"./vue-echarts-0ed26588.js";import"./resize-detector-a5205554.js";import"./echarts-eea5b079.js";import"./tslib-54e39b60.js";import"./zrender-ecf5ed03.js";import"./lodash-es-74a5df03.js";import"./vue-router-c769f697.js";import"./@vueuse.core-c33523a6.js";import"./@vueuse.shared-b7ebfaaa.js";import"./mitt-b509fb6d.js";import"./mockjs-597bdf6e.js";import"./vue-052dfabe.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./dayjs-e0a79e34.js";import"./async-validator-8a4f889d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-f47942fe.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-4390772d.js";import"./@floating-ui.core-1d013f45.js";import"./@floating-ui.utils-1e4a7d10.js";const le=I({name:"undefined"}),ie=I({...le,setup(g,{expose:s}){const{service:Y}=L(),f=O(!1),B=O(""),y=se({status:[{label:"成功",value:1,type:"success"},{label:"失败",value:0,type:"danger"}]}),D=M.useTable({autoHeight:!1,columns:[{label:"#",type:"index"},{label:"描述",prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:"执行状态",prop:"status",minWidth:120,dict:y.status},{label:"执行時間",prop:"createTime",minWidth:160}]}),u=M.useCrud({service:Y.task.info,dict:{api:{page:"log"}}});function V(k){f.value=!0,B.value=`日志列表（${k.name}）`,Z(()=>{var _;(_=u.value)==null||_.refresh({id:k.id,page:1})})}function F(){f.value=!1}return s({open:V,close:F}),(k,_)=>{const x=l("cl-refresh-btn"),q=l("cl-select"),E=l("cl-filter"),t=l("cl-row"),o=l("cl-table"),e=l("cl-flex1"),d=l("cl-pagination"),C=l("cl-crud"),w=l("cl-dialog");return c(),T(w,{modelValue:f.value,"onUpdate:modelValue":_[0]||(_[0]=m=>f.value=m),title:B.value,width:"1000px"},{default:i(()=>[n(C,{ref_key:"Crud",ref:u,padding:"0"},{default:i(()=>[n(t,null,{default:i(()=>[n(x),n(E,{label:"状态"},{default:i(()=>[n(q,{options:y.status,prop:"status",width:120},null,8,["options"])]),_:1})]),_:1}),n(t,null,{default:i(()=>[n(o,{ref_key:"Table",ref:D},null,512)]),_:1}),n(t,null,{default:i(()=>[n(e),n(d)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),j=g=>(te("data-v-23e61f78"),g=g(),oe(),g),re={class:"list"},ce=["onClick","onContextmenu"],pe={class:"name"},ue={class:"row"},de=j(()=>p("span",null,"执行服务",-1)),_e={class:"row"},me=j(()=>p("span",null,"定时规则",-1)),fe={class:"status"},ke=j(()=>p("p",null,"添加计划任务",-1)),he=I({name:"task-list"}),ve=I({...he,setup(g){const{service:s,refs:Y,setRefs:f}=L(),{browser:B}=A(),y=M.useForm(),D=O([]);function u(){s.task.info.page({size:100,page:1}).then(t=>{D.value=t.list.map(o=>(o.every&&(o._every=parseInt(String(o.every/1e3))),o))})}function V(t){H.confirm(`此操作将启用任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.start({id:t.id,type:t.type}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function F(t){H.confirm(`此操作将停用任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.stop({id:t.id}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function k(t){H.confirm(`此操作将删除任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.delete({ids:[t.id]}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function _(t){Y.log.open(t)}async function x(t){var o;if(t&&!s.task.info._permission.update)return!1;(o=y.value)==null||o.open({title:"编辑计划任务",width:"600px",props:{labelWidth:"80px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:"类型",prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:"時間间隔",value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:e})=>e.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:"间隔(秒)",prop:"every",hidden:({scope:e})=>e.taskType==0,hook:{bind(e){return e/1e3},submit(e){return e*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:"开始時間",prop:"startDate",hidden:({scope:e})=>e.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...t},on:{submit:(e,{close:d,done:C})=>{e.limit||(e.limit=null),s.task.info[t!=null&&t.id?"update":"add"](e).then(()=>{u(),b.success("保存成功"),d()}).catch(w=>{b.error(w.message),C()})}}},[M.setFocus()])}function q(t){s.task.info.once({id:t.id}).then(()=>{u()}).catch(o=>{b.error(o.message)})}function E(t,o){M.ContextMenu.open(t,{list:[o.status?{label:"暂停",hidden:!s.task.info._permission.stop,callback(e){F(o),e()}}:{label:"开始",hidden:!s.task.info._permission.start,callback(e){V(o),e()}},{label:"立即执行",hidden:!s.task.info._permission.once,callback(e){q(o),e()}},{label:"编辑",hidden:!(s.task.info._permission.update&&s.task.info._permission.info),callback(e){x(o),e()}},{label:"删除",hidden:!s.task.info._permission.delete,callback(e){k(o),e()}},{label:"查看日志",hidden:!s.task.info._permission.log,callback(e){_(o),e()}}]})}return G(()=>{u()}),(t,o)=>{const e=l("el-tag"),d=l("el-icon"),C=l("cl-flex1"),w=l("cl-form"),m=Q("permission");return c(),v("div",{class:ne(["task-list",{"is-mini":r(B).isMini}])},[p("div",re,[(c(!0),v(W,null,ee(D.value,(a,X)=>(c(),v("div",{key:X,class:"item",onClick:h=>x(a),onContextmenu:h=>{E(h,a)}},[p("p",pe,N(a.name),1),p("p",ue,[de,p("span",null,N(a.service),1)]),p("p",_e,[me,p("span",null,N(a.taskType==1?`间隔${a._every}秒执行`:a.cron),1)]),p("div",fe,[a.status?(c(),v(W,{key:0},[n(e,{"disable-transitions":"",effect:"dark",type:"success"},{default:i(()=>[z("进行中")]),_:1}),$((c(),T(d,{class:"pause",onClick:S(h=>F(a),["stop"])},{default:i(()=>[n(r(K))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.stop]])],64)):(c(),v(W,{key:1},[n(e,{"disable-transitions":"",effect:"dark",type:"danger"},{default:i(()=>[z("已停止")]),_:1}),$((c(),T(d,{class:"play",onClick:S(h=>V(a),["stop"])},{default:i(()=>[n(r(P))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.start]])],64)),n(C),$((c(),T(d,{class:"log",onClick:S(h=>_(a),["stop"])},{default:i(()=>[n(r(R))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.log]]),$((c(),T(d,{class:"delete",onClick:S(h=>k(a),["stop"])},{default:i(()=>[n(r(U))]),_:2},1032,["onClick"])),[[m,r(s).task.info.permission.delete]])])],40,ce))),128)),$((c(),v("div",{class:"item is-add",onClick:o[0]||(o[0]=a=>x())},[n(d,null,{default:i(()=>[n(r(J))]),_:1}),ke])),[[m,r(s).task.info.permission.add]])]),n(w,{ref_key:"Form",ref:y},null,512),n(ie,{ref:r(f)("log")},null,512)],2)}}});const st=ae(ve,[["__scopeId","data-v-23e61f78"]]);export{st as default};
