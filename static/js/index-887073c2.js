import{l as Z,v as ee}from"./@vue.runtime-dom-99571815.js";import{i as N,a as te}from"./index-76673f94.js";import{n as R,m as se,T as oe,B as ie,a1 as ne}from"./@element-plus.icons-vue-73c86597.js";import"./store-acb3382e.js";import{x as le}from"./lodash-es-74a5df03.js";import{a as b,b as ae}from"./element-plus-ca11a4ea.js";import{j as q,I as re,A as ce,d as ue,X as k,$ as O,o as n,c as p,a,G as C,b as r,K as c,N as B,J as _,n as de,L as E,F as pe,V as _e}from"./@vue.runtime-core-561bebe5.js";import{j as me,r as w,u as m}from"./@vue.reactivity-97074417.js";import{o as W,O as S}from"./@vue.shared-40d3234d.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import"./axios-f6771985.js";import"./nprogress-5ff42f71.js";import"./chardet-cfd7d38a.js";import"./pinia-d82d1bdc.js";import"./vue-demi-71ba0ef2.js";import"./monaco-editor-f913c445.js";import"./vue-echarts-0ed26588.js";import"./resize-detector-a5205554.js";import"./echarts-eea5b079.js";import"./tslib-54e39b60.js";import"./zrender-ecf5ed03.js";import"./vue-router-c769f697.js";import"./@vueuse.core-c33523a6.js";import"./@vueuse.shared-b7ebfaaa.js";import"./mitt-b509fb6d.js";import"./mockjs-597bdf6e.js";import"./vue-052dfabe.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./dayjs-e0a79e34.js";import"./async-validator-8a4f889d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-f47942fe.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-4390772d.js";import"./@floating-ui.core-1d013f45.js";import"./@floating-ui.utils-1e4a7d10.js";const ve={class:"cl-view-group__wrap"},he={class:"cl-view-group__left"},ge={class:"scope"},be={class:"head"},ke={class:"list"},Ce=["infinite-scroll-disabled"],we=["onClick","onContextmenu"],xe={class:"cl-view-group__right"},ye={class:"head"},Me={class:"title"},$e={key:0,class:"content"},Be=q({name:"cl-view-group"}),Ee=q({...Be,setup(Se,{expose:J}){Z(e=>({"94bfaf1a":s.leftWidth}));const{browser:x,onScreenChange:K}=te(),P=re(),A=N.useForm(),s=me(Object.assign({label:"组",title:"列表",leftWidth:"200px",data:{},service:{},enableContextMenu:!0,enableRefresh:!0,enableAdd:!0},ce("useViewGroup__options"))),T=!!P.left;le(s.service);const j=w(!1),d=w([]),f=w(!0),l=w();function v(e){f.value=e===void 0?!f.value:e}function y(e){e||(e=d.value[0]),l.value=e,de(()=>{e&&(x.isMini&&v(!1),s.onSelect&&s.onSelect(e))})}function F(e){var t,o;(o=A.value)==null||o.open({title:(e?"编辑":"添加")+s.label,form:{...e},on:{submit(u,{close:$,done:V}){s.service[e?"update":"add"](u).then(()=>{b.success("保存成功"),e?Object.assign(e,u):h(),$()}).catch(z=>{b.error(z.message),V()})}},...(t=s.onEdit)==null?void 0:t.call(s,e)},[N.setFocus()])}function G(e){ae.confirm("此操作将会删除选择的数据，是否继续？","提示",{type:"warning"}).then(()=>{s.service.delete({ids:[e.id]}).then(async()=>{var t;b.success("删除成功"),await h(),((t=l.value)==null?void 0:t.id)==e.id&&y()}).catch(t=>{b.error(t.message)})}).catch(()=>null)}const M={order:"createTime",sort:"asc",page:1,size:20},I=w(!1);async function h(e){if(T)return!1;Object.assign(M,e),j.value=!0,await s.service.page({...M,...s.data}).then(t=>{var u;const o=((u=s.onData)==null?void 0:u.call(s,t.list))||t.list;M.page==1?d.value=o:d.value.push(...o),y(l.value||d.value[0]),I.value=t.pagination.total<=d.value.length}).catch(t=>{b.error(t.message)}),j.value=!1}function X(){h({page:M.page+1})}function H(e,t){if(!s.enableContextMenu)return!1;N.ContextMenu.open(e,{hover:{target:"item"},list:[{label:"编辑",hidden:!s.service._permission.update,callback(o){o(),F(t)}},{label:"删除",hidden:!s.service._permission.delete,callback(o){o(),G(t)}}],...s.onContextMenu&&s.onContextMenu(t)})}return K(()=>{v(!x.isMini)}),ue(()=>{h()}),J({selected:l,isExpand:f,expand:v,select:y,browser:x,edit:F,remove:G}),(e,t)=>{const o=k("el-icon"),u=k("el-tooltip"),$=k("el-empty"),V=k("el-scrollbar"),z=k("cl-form"),Q=O("permission"),U=O("infinite-scroll"),Y=O("loading");return n(),p("div",{class:W(["cl-view-group",[f.value?"is-expand":"is-collapse"]])},[a("div",ve,[a("div",he,[C(e.$slots,"left",{},()=>[a("div",ge,[a("div",be,[a("span",null,S(s.label),1),s.enableRefresh?(n(),_(u,{key:0,content:"刷新"},{default:c(()=>[r(o,{onClick:t[0]||(t[0]=i=>h())},{default:c(()=>[r(m(oe))]),_:1})]),_:1})):B("",!0),s.enableAdd?(n(),_(u,{key:1,content:"添加"},{default:c(()=>[E((n(),_(o,{onClick:t[1]||(t[1]=i=>F())},{default:c(()=>[r(m(ie))]),_:1})),[[Q,s.service.permission.add]])]),_:1})):B("",!0)]),E((n(),p("div",ke,[r(V,null,{default:c(()=>[E((n(),p("ul",{"infinite-scroll-immediate":!1,"infinite-scroll-disabled":I.value},[(n(!0),p(pe,null,_e(d.value,(i,D)=>(n(),p("li",{key:D,onClick:g=>y(i),onContextmenu:g=>{H(g,i)}},[C(e.$slots,"item",{item:i,selected:l.value,index:D},()=>{var g,L;return[a("div",{class:W(["item",{"is-active":((g=l.value)==null?void 0:g.id)==i.id}])},[C(e.$slots,"item-name",{item:i,selected:l.value,index:D},()=>[a("span",null,S(i.name),1)],!0),E(r(o,{class:"arrow-right"},{default:c(()=>[r(m(ne))]),_:2},1536),[[ee,((L=l.value)==null?void 0:L.id)==i.id]])],2)]},!0)],40,we))),128)),d.value.length==0?(n(),_($,{key:0,"image-size":80})):B("",!0)],8,Ce)),[[U,X]])]),_:3})])),[[Y,j.value]])])],!0),m(x).isMini?(n(),p("div",{key:0,class:"collapse-btn",onClick:t[2]||(t[2]=i=>v(!1))},[r(o,null,{default:c(()=>[r(m(R))]),_:1})])):B("",!0)]),a("div",xe,[a("div",ye,[a("div",{class:"icon",onClick:t[3]||(t[3]=i=>v())},[f.value?(n(),_(o,{key:0},{default:c(()=>[r(m(se))]),_:1})):(n(),_(o,{key:1},{default:c(()=>[r(m(R))]),_:1}))]),C(e.$slots,"title",{selected:l.value},()=>{var i;return[a("span",Me,S(s.title)+"（"+S(((i=l.value)==null?void 0:i.name)||"未选择")+"） ",1)]},!0)]),l.value?(n(),p("div",$e,[C(e.$slots,"right",{},void 0,!0)])):(n(),_($,{key:1,"image-size":80}))])]),r(z,{ref_key:"Form",ref:A},null,512)],2)}}});const _t=fe(Ee,[["__scopeId","data-v-0e6e3fe8"]]);export{_t as default};
