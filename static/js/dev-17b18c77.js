import{D as A}from"./@element-plus.icons-vue-73c86597.js";import{_ as G}from"./func-logs.vue_vue_type_script_setup_true_lang-f5f4519e.js";import{s as S,C as H}from"./index-c3533fa0.js";import{u as P}from"./index-292cfcf2.js";import{a as d}from"./element-plus-ca11a4ea.js";import{j,d as Q,X as c,$ as W,o as r,c as m,a as e,b as n,K as i,O as g,L as Y,J as x,F as Z,as as ee,ar as oe}from"./@vue.runtime-core-561bebe5.js";import{r as h,j as te,u}from"./@vue.reactivity-97074417.js";import{O as y}from"./@vue.shared-40d3234d.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-f25a0731.js";import"./store-acb3382e.js";import"./chardet-cfd7d38a.js";import"./@vue.runtime-dom-99571815.js";import"./axios-f6771985.js";import"./nprogress-5ff42f71.js";import"./pinia-d82d1bdc.js";import"./vue-demi-71ba0ef2.js";import"./monaco-editor-f913c445.js";import"./vue-echarts-0ed26588.js";import"./resize-detector-a5205554.js";import"./echarts-eea5b079.js";import"./tslib-54e39b60.js";import"./zrender-ecf5ed03.js";import"./lodash-es-74a5df03.js";import"./vue-router-c769f697.js";import"./@vueuse.core-c33523a6.js";import"./@vueuse.shared-b7ebfaaa.js";import"./mitt-b509fb6d.js";import"./mockjs-597bdf6e.js";import"./vue-052dfabe.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./dayjs-e0a79e34.js";import"./async-validator-8a4f889d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-f47942fe.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-4390772d.js";import"./@floating-ui.core-1d013f45.js";import"./@floating-ui.utils-1e4a7d10.js";const _=p=>(ee("data-v-de98b7be"),p=p(),oe(),p),ne={class:"func-dev"},le={class:"head"},ae={class:"name"},ie={class:"btn"},ce={class:"container"},re={class:"code"},de={class:"debug"},ue={class:"card"},_e={class:"h"},me=_(()=>e("span",null,"调用参数",-1)),pe={class:"c"},fe={class:"card"},ve={class:"h"},ge=_(()=>e("span",null,"执行日志",-1)),he={class:"c is-border"},ye={class:"c2"},Ce={class:"row"},ke=_(()=>e("div",{class:"row"},[e("span",null,"执行時間：2023-02-16 01:23:00")],-1)),we={class:"row"},be=_(()=>e("span",null,"执行状态：",-1)),qe={key:0,class:"ok"},Se={key:1,class:"fail"},xe=_(()=>e("span",{style:{"margin-left":"20px"}},"耗时：",-1)),Ve=_(()=>e("div",{class:"row"},"执行结果：",-1)),$e={key:1,class:"error"},ze=j({name:"cloud-func-dev"}),Ke=j({...ze,setup(p){const{route:I,service:C,refs:k,setRefs:w,router:N}=P(),b=h(!1),q=h(!1),f=h(!1),s=te({req:"",log:{error:"",type:0,time:0,createTime:"",result:{},request:{method:""}}}),a=h({content:""});async function V(o){b.value=!0,await C.cloud.func.info.info({id:I.query.id}).then(t=>{o||(t.content=S.get(`cloud.devCode-${t.id}`)||t.content,s.req=S.get(`cloud.devReq-${t.id}`)||H.req),a.value=t}).catch(t=>{d.error(t.message)}),b.value=!1}async function $(){q.value=!0,await k.code.formatCode(),await C.cloud.func.info.update({id:a.value.id,content:a.value.content}).then(()=>{d.success("保存成功")}).catch(o=>{d.error(o.message)}),q.value=!1}async function z(){f.value=!0,await k.req.formatCode();try{await C.cloud.func.info.invoke({id:a.value.id,content:a.value.content,...JSON.parse(s.req)}).then(o=>{s.log=o,d.success("运行成功")}).catch(o=>{s.log.time=0,d.error(o.message)})}catch(o){d.error(o==null?void 0:o.toString())}f.value=!1}function K(o,t){S.set(`cloud.${o}-${a.value.id}`,t)}function R(o){o.ctrlKey&&o.key.toLocaleLowerCase()=="s"&&($(),o.preventDefault())}function O(o){o.ctrlKey&&o.key.toLocaleLowerCase()=="b"&&(z(),o.preventDefault())}return Q(()=>{V()}),(o,t)=>{const E=c("el-icon"),v=c("el-button"),F=c("el-tooltip"),D=c("cl-editor-monaco"),B=c("el-col"),J=c("cl-code-json"),M=c("el-empty"),T=c("el-scrollbar"),U=c("el-row"),X=W("loading");return r(),m("div",ne,[e("div",le,[n(E,{class:"back",onClick:u(N).back},{default:i(()=>[n(u(A))]),_:1},8,["onClick"]),e("span",ae,"云函数（"+y(a.value.name)+"）",1),e("div",ie,[n(F,{content:"重新加载函数代码,将会丢失当前未保存的编辑",effect:"light"},{default:i(()=>[n(v,{size:"small",loading:b.value,onClick:t[0]||(t[0]=l=>V(!0))},{default:i(()=>[g(" 刷新 ")]),_:1},8,["loading"])]),_:1}),n(v,{size:"small",type:"success",loading:q.value,onClick:$},{default:i(()=>[g(" 保存(S) ")]),_:1},8,["loading"])])]),e("div",ce,[e("div",re,[n(D,{ref:u(w)("code"),height:"100%",language:"typescript",options:{fontSize:18},modelValue:a.value.content,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.content=l),onChange:t[2]||(t[2]=l=>{K("devCode",l)}),onKeydown:R},null,8,["modelValue"])]),e("div",de,[n(U,{gutter:10},{default:i(()=>[n(B,{sm:12,xs:24},{default:i(()=>[e("div",ue,[e("div",_e,[me,n(v,{size:"small",type:"success",loading:f.value,onClick:z},{default:i(()=>[g(" 运行(B) ")]),_:1},8,["loading"])]),e("div",pe,[n(D,{ref:u(w)("req"),height:"100%",options:{fontSize:18},modelValue:s.req,"onUpdate:modelValue":t[3]||(t[3]=l=>s.req=l),onKeydown:O,onChange:t[4]||(t[4]=l=>{K("devReq",l)})},null,8,["modelValue"])])])]),_:1}),n(B,{sm:12,xs:24},{default:i(()=>[e("div",fe,[e("div",ve,[ge,n(v,{size:"small",onClick:t[5]||(t[5]=l=>{var L;return(L=u(k).logs)==null?void 0:L.open(a.value)})},{default:i(()=>[g(" 查看全部 ")]),_:1})]),e("div",he,[Y((r(),x(T,null,{default:i(()=>{var l;return[e("div",ye,[s.log.time>0?(r(),m(Z,{key:0},[e("div",Ce,[e("span",null,"执行方法："+y((l=s.log.request)==null?void 0:l.method),1)]),ke,e("div",we,[be,s.log.type==1?(r(),m("span",qe,"成功")):(r(),m("span",Se,"失败")),xe,e("span",null,y(s.log.time)+"ms",1)]),Ve,s.log.type==1?(r(),x(J,{key:0,height:"auto","model-value":s.log.result},null,8,["model-value"])):(r(),m("div",$e,y(s.log.error),1))],64)):(r(),x(M,{key:1,"image-size":80}))])]}),_:1})),[[X,f.value]])])])]),_:1})]),_:1})])]),n(G,{ref:u(w)("logs")},null,512)])}}});const ho=se(Ke,[["__scopeId","data-v-de98b7be"]]);export{ho as default};
