import{W as z}from"./@element-plus.icons-vue-73c86597.js";import{o as H}from"./vue-router-c769f697.js";import"./index-c3533fa0.js";import"./store-acb3382e.js";import{u as A}from"./index-292cfcf2.js";import{a as C}from"./element-plus-ca11a4ea.js";import{j as D,d as w,e as E,X as a,o as S,c as T,a as s,b as o,K as n,O as B,as as L,ar as O}from"./@vue.runtime-core-561bebe5.js";import{r as k,j as I}from"./@vue.reactivity-97074417.js";import{_ as $}from"./_plugin-vue_export-helper-c27b6911.js";import"./@vue.runtime-dom-99571815.js";import"./@vue.shared-40d3234d.js";import"./axios-f6771985.js";import"./nprogress-5ff42f71.js";import"./chardet-cfd7d38a.js";import"./pinia-d82d1bdc.js";import"./vue-demi-71ba0ef2.js";import"./monaco-editor-f913c445.js";import"./vue-echarts-0ed26588.js";import"./resize-detector-a5205554.js";import"./echarts-eea5b079.js";import"./tslib-54e39b60.js";import"./zrender-ecf5ed03.js";import"./lodash-es-74a5df03.js";import"./@vueuse.core-c33523a6.js";import"./@vueuse.shared-b7ebfaaa.js";import"./mitt-b509fb6d.js";import"./mockjs-597bdf6e.js";import"./vue-052dfabe.js";import"./@popperjs.core-c75af06c.js";import"./@ctrl.tinycolor-f8748455.js";import"./dayjs-e0a79e34.js";import"./async-validator-8a4f889d.js";import"./memoize-one-297ddbcb.js";import"./escape-html-f47942fe.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui.dom-4390772d.js";import"./@floating-ui.core-1d013f45.js";import"./@floating-ui.utils-1e4a7d10.js";const N=D({name:"project-add",components:{Edit:z},setup(){const{refs:e,setRefs:l,service:b,route:y,router:U}=A(),f=k(!1);w(()=>window.addEventListener("keypress",c)),E(async()=>window.removeEventListener("keypress",c));const c=()=>f.value=!0;H(()=>{if(!f.value)return;if(!window.confirm("尚未儲存修改內容，確定要離開嗎?"))return!1});const V=i=>{f.value&&(i.preventDefault(),i.returnValue=!0)};w(()=>window.addEventListener("beforeunload",V)),E(()=>window.removeEventListener("beforeunload",V));const r=I({project:{id:null,slug:null,video:null,cover:null,isFeature:!0,publish:!0,publishTime:null},info:{en:{id:null,locale:"en",title:null,intro:null,seoTitle:null,seoDescription:null},"zh-Hant":{id:null,locale:"zh-Hant",title:null,intro:null,seoTitle:null,seoDescription:null}}}),p=k("zh-Hant");return w(async()=>{const i=y.query.id,{project:h,info:d}=await b.project.index.info({id:i});for(const[u,m]of Object.entries(h))u in r.project&&(r.project[u]=m);const j=d.en,g=d["zh-Hant"];for(const[u,m]of Object.entries(j))u in r.info.en&&(r.info.en[u]=m);for(const[u,m]of Object.entries(g))u in r.info["zh-Hant"]&&(r.info["zh-Hant"][u]=m)}),{service:b,refs:e,setRefs:l,onSubmit:async()=>{Array.isArray(r.project.cover)&&r.project.cover.length&&(r.project.cover=r.project.cover[0]),Array.isArray(r.project.video)&&r.project.video.length&&(r.project.video=r.project.video[0]),await b.project.index.edit(r).then(i=>{C.success("成功"),f.value=!1}).catch(i=>{C.error(i)})},form:r,locale:p}}});const v=e=>(L("data-v-c523bffd"),e=e(),O(),e),M={class:"add"},R={class:"add-header"},q=v(()=>s("h4",null,"編輯作品",-1)),K={class:"grid-content"},P=v(()=>s("h3",null,"Project",-1)),W={class:"grid-content"},X=v(()=>s("h3",null,"Slug",-1)),Z={class:"grid-content"},G=v(()=>s("h3",null,"SEO",-1)),J={class:"grid-content"},Q={class:"grid-content"},Y=v(()=>s("h3",null,"封面 & 影片",-1));function x(e,l,b,y,U,f){const c=a("el-option"),V=a("el-select"),r=a("el-button"),p=a("el-divider"),_=a("el-input"),i=a("el-form-item"),h=a("cl-editor-wang"),d=a("el-form"),j=a("el-col"),g=a("el-switch"),u=a("el-date-picker"),m=a("cl-upload"),F=a("el-row");return S(),T("div",M,[s("div",R,[q,o(V,{style:{width:"120px"},modelValue:e.locale,"onUpdate:modelValue":l[0]||(l[0]=t=>e.locale=t),placeholder:"選擇語系"},{default:n(()=>[o(c,{label:"中文",value:"zh-Hant"}),o(c,{label:"English",value:"en"})]),_:1},8,["modelValue"]),o(r,{type:"primary",onClick:e.onSubmit},{default:n(()=>[B("送出")]),_:1},8,["onClick"])]),o(F,{class:"add-body",justify:"end",gutter:12},{default:n(()=>[o(j,{style:{"margin-bottom":"20px"},lg:18},{default:n(()=>[s("div",K,[P,o(p),o(d,{model:e.form,"label-position":"top"},{default:n(()=>[o(i,{label:"標題"},{default:n(()=>[o(_,{size:"large",modelValue:e.form.info[e.locale].title,"onUpdate:modelValue":l[1]||(l[1]=t=>e.form.info[e.locale].title=t)},null,8,["modelValue"])]),_:1}),o(i,{label:"簡介"},{default:n(()=>[o(h,{modelValue:e.form.info[e.locale].intro,"onUpdate:modelValue":l[2]||(l[2]=t=>e.form.info[e.locale].intro=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),s("div",W,[X,o(p),o(d,{model:e.form,"label-position":"top"},{default:n(()=>[o(i,null,{default:n(()=>[o(_,{modelValue:e.form.project.slug,"onUpdate:modelValue":l[3]||(l[3]=t=>e.form.project.slug=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),s("div",Z,[G,o(p),o(d,{model:e.form,"label-position":"top"},{default:n(()=>[o(i,{label:"標題"},{default:n(()=>[o(_,{size:"large",modelValue:e.form.info[e.locale].seoTitle,"onUpdate:modelValue":l[4]||(l[4]=t=>e.form.info[e.locale].seoTitle=t)},null,8,["modelValue"])]),_:1}),o(i,{label:"簡介"},{default:n(()=>[o(_,{type:"textarea",rows:"5",modelValue:e.form.info[e.locale].seoDescription,"onUpdate:modelValue":l[5]||(l[5]=t=>e.form.info[e.locale].seoDescription=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1}),o(j,{lg:6},{default:n(()=>[s("div",J,[o(d,{model:e.form,"label-position":"left","label-width":"75"},{default:n(()=>[o(i,{label:"已發布"},{default:n(()=>[o(g,{modelValue:e.form.project.publish,"onUpdate:modelValue":l[6]||(l[6]=t=>e.form.project.publish=t),style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"}},null,8,["modelValue"])]),_:1}),o(i,{label:"發布時間"},{default:n(()=>[o(u,{modelValue:e.form.project.publishTime,"onUpdate:modelValue":l[7]||(l[7]=t=>e.form.project.publishTime=t),type:"datetime",placeholder:"輸入發布時間"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),s("div",Q,[Y,o(p),o(d,{model:e.form,"label-position":"left","label-width":"75"},{default:n(()=>[o(i,{label:"封面"},{default:n(()=>[o(m,{draggable:"",style:{background:"#fff"},"is-space":"",accept:"image/*",modelValue:e.form.project.cover,"onUpdate:modelValue":l[8]||(l[8]=t=>e.form.project.cover=t)},null,8,["modelValue"])]),_:1}),o(i,{label:"影片"},{default:n(()=>[o(m,{type:"file",style:{background:"#fff"},"is-space":"",accept:"video/*",modelValue:e.form.project.video,"onUpdate:modelValue":l[9]||(l[9]=t=>e.form.project.video=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})])}const Ie=$(N,[["render",x],["__scopeId","data-v-c523bffd"]]);export{Ie as default};
